<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Ford Property Services ‚Ä¢ Photo Notes</title>
<meta name="theme-color" content="#0b1220">

<style>
:root{
  --bg:#0b1220; --line:rgba(255,255,255,.14);
  --text:#e7eefc; --muted:#a9b7d3;
  --good:#22c55e; --bad:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
  background:var(--bg);
}
header{
  position:sticky;top:0;z-index:10;
  background:#0b1220;
  border-bottom:1px solid var(--line);
}
.wrap{max-width:1100px;margin:0 auto;padding:14px 16px}
.top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
.brand{display:flex;gap:12px;align-items:center}
.logo{
  width:54px;height:54px;border-radius:14px;
  background:#fff;color:#000;
  display:grid;place-items:center;font-weight:900;
}
main{max-width:1100px;margin:0 auto;padding:16px}
.card{
  border:1px solid var(--line);
  border-radius:18px;
  padding:14px;
}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{
  background:rgba(255,255,255,.06);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px 12px;
  font-weight:900;
}
input,textarea{
  width:100%;
  background:rgba(0,0,0,.2);
  color:var(--text);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px 12px;
}
textarea{min-height:90px}
.grid{display:grid;gap:12px;margin-top:12px}
@media(min-width:800px){.grid{grid-template-columns:1fr 1fr}}
.item{border:1px solid var(--line);border-radius:18px;padding:12px}
.thumb{aspect-ratio:4/3;border:1px solid var(--line);border-radius:14px;overflow:hidden;margin-bottom:8px}
.thumb img{width:100%;height:100%;object-fit:contain}
.small{font-size:12px;color:var(--muted)}
.toast{
  position:fixed;bottom:16px;left:50%;
  transform:translateX(-50%);
  background:#000;color:#fff;
  padding:10px 14px;border-radius:14px;
  display:none;font-weight:900;
}
</style>
</head>

<body>

<header>
  <div class="wrap top">
    <div class="brand">
      <div class="logo">FPS</div>
      <div>
        <strong>Ford Property Services</strong><br>
        <span class="small">Photo Notes</span>
      </div>
    </div>
    <a href="/app/dashboard/" style="color:#9ecbff;text-decoration:none">‚Üê Dashboard</a>
  </div>
</header>

<!-- IMPORTANT: NO capture attribute -->
<input id="photoInput" type="file" accept="image/*" multiple style="display:none">

<main>
  <div class="card">

    <div class="row">
      <button id="addPhotos">üñºÔ∏è Add photos (Gallery / Camera)</button>
      <button id="saveDraft">üíæ Save draft</button>
      <button onclick="window.print()">üßæ Save PDF</button>
    </div>

    <div class="row" style="margin-top:12px">
      <input id="job" placeholder="Job / Address">
      <input id="date" type="date">
    </div>

    <textarea id="general" placeholder="General notes..." style="margin-top:12px"></textarea>

    <div id="list" class="grid"></div>

  </div>
</main>

<div id="toast" class="toast">Saved</div>

<script>
const $=id=>document.getElementById(id);
const STORAGE="fps_photo_notes_v2";
let state={job:"",date:"",general:"",items:[]};

function toast(msg){
  const t=$("toast");t.textContent=msg;t.style.display="block";
  setTimeout(()=>t.style.display="none",1400);
}

function save(){localStorage.setItem(STORAGE,JSON.stringify(state))}
function load(){
  const raw=localStorage.getItem(STORAGE);
  if(raw)state=JSON.parse(raw);
  $("job").value=state.job||"";
  $("date").value=state.date||"";
  $("general").value=state.general||"";
  render();
}

$("job").oninput=()=>{state.job=$("job").value;save()}
$("date").onchange=()=>{state.date=$("date").value;save()}
$("general").oninput=()=>{state.general=$("general").value;save()}

$("addPhotos").onclick=()=>$("photoInput").click();

$("photoInput").onchange=async e=>{
  for(const f of e.target.files){
    const img=new Image();
    img.src=URL.createObjectURL(f);
    await img.decode();
    const c=document.createElement("canvas");
    c.width=img.width;c.height=img.height;
    c.getContext("2d").drawImage(img,0,0);
    state.items.push({img:c.toDataURL("image/jpeg",0.95),note:""});
  }
  save();render();toast("Photos added");
};

function render(){
  const list=$("list");list.innerHTML="";
  state.items.forEach((it,i)=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <div class="thumb"><img src="${it.img}"></div>
      <textarea placeholder="Notes..." data-i="${i}">${it.note}</textarea>
      <button data-del="${i}" style="margin-top:6px">üóëÔ∏è Delete</button>
    `;
    d.querySelector("textarea").oninput=e=>{
      it.note=e.target.value;save();
    };
    d.querySelector("button").onclick=()=>{
      state.items.splice(i,1);save();render();
    };
    list.appendChild(d);
  });
}

$("saveDraft").onclick=()=>{
  save();
  const blob=new Blob([JSON.stringify(state,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="photo-notes-draft.json";
  a.click();
  toast("Draft saved");
};

(function init(){
  const d=new Date();
  $("date").value=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  load();
})();
</script>

</body>
</html>
